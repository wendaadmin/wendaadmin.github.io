import{d as A,r as C,e as O,f as H,o as v,c as V,b as x,g as n,w as a,h as y,u as o,s as X,t as Y,y as Z,i as ee,j as F,B as te,A as M,k as j,E as d,l as S,m as L,n as J,v as oe,F as Q,C as R,D as ne,G as se,H as le,I as ae,J as ie,K as re,p as ce,a as pe,_ as ue,L as de,M as N,N as U,z as me}from"./entry.b627817d.js";import"./request.8511a56b.js";import{t as fe,b as _e,c as ge,d as ye,e as ve,f as be,g as xe}from"./el-loading.92ba49b6.js";/* empty css                  *//* empty css                */import{d as he}from"./dataExcelExport.a617cdae.js";import{_ as we}from"./client-only.8d3af453.js";/* empty css                        */const ke={class:"w-full flex flex-col space-y-3"},Ce=A({__name:"Index",emits:["update:lookItem"],setup(h,{emit:b}){const c=C(!1),f=C(!1),g=O({content:[],totalElements:0}),w=i=>{j.prompt("请输入密码","删除",{confirmButtonText:"确定",cancelButtonText:"删除"}).then(async({value:_})=>{const p=await fe(i,_);p.code==200?(d({type:"success",message:p.msg}),t()):d({type:"error",message:p.msg})}).catch(()=>{d({type:"info",message:"Input canceled"})})},t=async()=>{try{f.value=!0;const i=await _e();i.code===200?g.content=i.data:d.error(i.msg)}catch{}finally{f.value=!1}},q=async()=>{const i=document.createElement("input");i.type="file",i.accept=".csv",i.onchange=async _=>{const p=_.target.files;if(p&&p.length>0){const r=p[0],l=new FormData;l.append("file",r);try{c.value=!0;const e=await ge(l);e.code===200?(d.success(e.msg),t()):d.error(e.msg)}catch(e){d.error("导入失败: "+(e.message||"未知错误"))}finally{c.value=!1}}},i.click()},B=async()=>{try{await he("题库下载模板",[["topicid","topic","questionid","questiontype","question","options","rates","status"]],[])}catch{}finally{}};return H(()=>{t()}),(i,_)=>{const p=S,r=L,l=J,e=oe;return v(),V("div",ke,[x("div",null,[n(p,{type:"info",onClick:B,icon:o(X)},{default:a(()=>[y("下载模板")]),_:1},8,["icon"]),n(p,{type:"success",onClick:q,loading:o(c),icon:o(Y)},{default:a(()=>[y("导入")]),_:1},8,["loading","icon"]),n(p,{type:"primary",onClick:_[0]||(_[0]=s=>t()),loading:o(f),icon:o(Z)},{default:a(()=>[y("查询")]),_:1},8,["loading","icon"])]),ee((v(),F(l,{data:o(g).content,style:{width:"100%"},border:"",height:"700px"},{default:a(()=>[n(r,{prop:"topicid",label:"题库号",fixed:"",align:"center",width:"100px"}),n(r,{prop:"topic",label:"问卷名称",fixed:"",align:"center"}),n(r,{align:"center",label:"操作"},{default:a(s=>[n(p,{link:"",size:"small",type:"primary",onClick:I=>b("update:lookItem",s.row),icon:o(te)},{default:a(()=>[y(" 查看 ")]),_:2},1032,["onClick","icon"]),n(p,{size:"small",link:"",type:"danger",onClick:I=>w(s.row.topicid),icon:o(M)},{default:a(()=>[y(" 删除 ")]),_:2},1032,["onClick","icon"])]),_:1})]),_:1},8,["data"])),[[e,o(f)]])])}}});const G=h=>(ce("data-v-213ed251"),h=h(),pe(),h),Ee={class:"flex items-center"},$e={class:"ml-7"},Ve={class:"w-[105px] flex items-center mb-2"},qe=G(()=>x("span",{class:"text-[14px] text-[#626066]"},"问卷选项： ",-1)),Ie={class:"grid grid-cols-2 gap-3 pl-8"},Be=["onClick"],De=G(()=>x("span",{class:"iconfont icon-del text-[7px] font-bold mt-[1px]"},null,-1)),Te=[De],Oe={class:"flex items-center justify-center mt-5"},Fe=A({__name:"TopicAddOrEdit",props:{dialogVisible:{type:Boolean,default:!1},item:{default:null},topicid:{default:null}},emits:["update:closeDialog","update:success"],setup(h,{emit:b}){const c=h,f=C(!1),g=C(),w=O({question:[{required:!0,message:"请输入",trigger:"blur"}],options:[{required:!0,message:"请输入",trigger:"blur"}]}),t=O({question:"",questiontype:1,rates:[],status:1,options:[""]}),q=e=>{e&&e.resetFields()},B=async e=>{e&&(f.value||await e.validate(async(s,I)=>{var E;if(s)try{if(f.value=!0,!i())return;const m={...t,options:t.options.join("|"),rates:t.rates.join("|")};let u;(E=c.item)!=null&&E.id?u=await ye(c.topicid,c.item.id,m):u=await ve(c.topicid,m),u.code==200?(d.success({message:u.msg||"success",grouping:!0,type:"success"}),b("update:success"),_()):d.error({message:u.msg,grouping:!0,type:"error"})}catch{}finally{f.value=!1}}))},i=()=>{if(t.options.length!==t.rates.length)return d.warning("选项和概率数量不匹配"),!1;for(let e=0;e<t.options.length;e++)if(!t.options[e]||t.options[e].trim()==="")return d.warning(`第${e+1}个选项内容不能为空`),!1;for(let e=0;e<t.rates.length;e++)if(t.rates[e]===null||t.rates[e]===void 0||isNaN(t.rates[e]))return d.warning(`第${e+1}个选项概率不能为空`),!1;return!0},_=()=>{b("update:closeDialog"),q(g.value)},p=()=>{t.options.push(""),t.rates.push(.3)},r=e=>{t.options.length>1?t.options.splice(e,1):d.warning("至少保留一个选项")},l=async()=>{var s;t.question="",t.options=[""],t.rates=[.3];const e=JSON.parse(JSON.stringify(c.item));(s=c.item)!=null&&s.id&&(t.question=e.question,t.questiontype=e.type,t.options=e.options,t.rates=JSON.parse(e.rates))};return(e,s)=>{const I=ne,E=se,m=le,u=ae,$=S,K=ie,P=re,W=we;return v(),V("div",null,[n(W,null,{default:a(()=>{var z;return[n(P,{title:(z=c.item)!=null&&z.id?"编辑":"新增",draggable:"","model-value":e.$props.dialogVisible,top:"20px",style:{"border-radius":"10px","padding-bottom":"20px"},width:"700px",class:"px-5","align-center":"",onClose:_,onOpen:s[5]||(s[5]=k=>l())},{default:a(()=>[n(K,{ref_key:"ruleFormRef",ref:g,class:"w-full",inline:!0,"label-position":"right",model:o(t),"label-width":"100px",rules:o(w)},{default:a(()=>[n(E,{label:"问卷内容:",prop:"question",class:"w-full"},{default:a(()=>[n(I,{style:{width:"100%"},"controls-position":"right",modelValue:o(t).question,"onUpdate:modelValue":s[0]||(s[0]=k=>o(t).question=k),placeholder:"请输入",clearable:""},null,8,["modelValue"])]),_:1}),x("div",Ee,[n(E,{label:"选项类型:",prop:"questiontype"},{default:a(()=>[n(m,{size:"large",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},modelValue:o(t).questiontype,"onUpdate:modelValue":s[1]||(s[1]=k=>o(t).questiontype=k),"inline-prompt":"","active-text":"单选","inactive-text":"多选","active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),n(E,{label:"状态:",prop:"status"},{default:a(()=>[n(m,{size:"large",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},modelValue:o(t).status,"onUpdate:modelValue":s[2]||(s[2]=k=>o(t).status=k),"inline-prompt":"","active-text":"可用","inactive-text":"不可用","active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),x("div",$e,[x("div",Ve,[qe,x("span",{class:"w-4 h-4 rounded-full bg-[#2b2b2bae] flex items-center justify-center text-[#EBEBEB] font-bold cursor-pointer hover:scale-110 duration-500",onClick:s[3]||(s[3]=k=>p())},"+")]),x("div",Ie,[(v(!0),V(Q,null,R(o(t).options,(k,D)=>(v(),V("div",{key:D,class:"flex items-center space-x-1 relative"},[n(I,{class:"flex-1",modelValue:o(t).options[D],"onUpdate:modelValue":T=>o(t).options[D]=T,placeholder:"选项"},null,8,["modelValue","onUpdate:modelValue"]),n(u,{style:{width:"85px"},min:0,max:1,"controls-position":"right",modelValue:o(t).rates[D],"onUpdate:modelValue":T=>o(t).rates[D]=T,placeholder:"概率",clearable:""},null,8,["modelValue","onUpdate:modelValue"]),x("div",{class:"w-3 h-3 rounded-full absolute right-2 bg-[#f56c6c] flex items-center justify-center text-[#EBEBEB] cursor-pointer hover:scale-110 duration-500",onClick:T=>r(D)},Te,8,Be)]))),128))])]),x("div",Oe,[n($,{type:"info",onClick:_},{default:a(()=>[y(" 取消 ")]),_:1}),n($,{loading:o(f),type:"primary",onClick:s[4]||(s[4]=k=>B(o(g)))},{default:a(()=>[y(" 保存 ")]),_:1},8,["loading"])])]),_:1},8,["model","rules"])]),_:1},8,["title","model-value"])]}),_:1})])}}});const Ae=ue(Fe,[["__scopeId","data-v-213ed251"]]),Ne={class:"flex flex-col space-y-3"},Ue={key:0},Se=A({__name:"Item",props:{item:{default:null}},emits:["update:lookIndex"],setup(h,{emit:b}){const c=h,f=C(!1),g=C(null),w=C(!1),t=O({content:[],totalElements:0}),q=de(()=>{const r=Math.max(...t.content.map(l=>{var e;return((e=l.options)==null?void 0:e.length)||0}),0);return Array.from({length:r},(l,e)=>e)}),B=r=>String.fromCharCode(65+r),i=async()=>{var r;try{w.value=!0;const l=await be((r=c.item)==null?void 0:r.topicid);l.code===200?t.content=l.data:d.error(l.msg)}catch{}finally{w.value=!1}},_=r=>{f.value=!0,g.value=r},p=(r,l)=>{j.confirm("确定删除该条数据?","Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then(async()=>{const e=await xe(r,l);e.code==200?(d({type:"success",message:e.msg}),i()):d({type:"error",message:e.msg})}).catch(()=>{d({type:"info",message:"Delete canceled"})})};return H(async()=>{i()}),(r,l)=>{const e=S,s=L,I=J,E=Ae;return v(),V("div",Ne,[x("div",null,[n(e,{type:"success",onClick:l[0]||(l[0]=m=>b("update:lookIndex"))},{default:a(()=>[y("返回")]),_:1}),n(e,{type:"success",onClick:l[1]||(l[1]=m=>_({}))},{default:a(()=>[y("新增")]),_:1})]),n(I,{data:o(t).content,style:{width:"100%"},border:"",height:"700px"},{default:a(()=>[n(s,{prop:"question",label:"问卷调查的内容",fixed:""}),n(s,{prop:"type",label:"类型",fixed:"",align:"center"},{default:a(m=>[y(N(m.row.type===1?"单选":"多选"),1)]),_:1}),n(s,{label:"问卷内容选项",align:"center"},{default:a(()=>[(v(!0),V(Q,null,R(o(q),(m,u)=>(v(),F(s,{key:u,prop:"option"+u,label:`选项${u+1}`,"column-key":"option"+u},{default:a($=>[$.row.options[u]?(v(),V("div",Ue,N(B(u))+". "+N($.row.options[u]),1)):U("",!0)]),_:2},1032,["prop","label","column-key"]))),128))]),_:1}),n(s,{align:"center",label:"操作"},{default:a(m=>[n(e,{size:"small",link:"",type:"success",onClick:u=>_(m.row),icon:o(me)},{default:a(()=>[y(" 编辑 ")]),_:2},1032,["onClick","icon"]),n(e,{size:"small",link:"",type:"danger",onClick:u=>{var $;return p(($=c.item)==null?void 0:$.topicid,m.row.id)},icon:o(M)},{default:a(()=>[y(" 删除 ")]),_:2},1032,["onClick","icon"])]),_:1})]),_:1},8,["data"]),n(E,{"dialog-visible":o(f),"onUpdate:closeDialog":l[2]||(l[2]=m=>f.value=!1),"onUpdate:success":l[3]||(l[3]=m=>i()),topicid:c.item.topicid,item:o(g)},null,8,["dialog-visible","topicid","item"])])}}}),ze={class:"w-full h-full flex flex-col space-y-3 overflow-auto"},Ke=A({__name:"questionnaireLibrary",setup(h){const b=C("index"),c=C(),f=g=>{c.value=g,b.value="item"};return(g,w)=>{const t=Ce,q=Se;return v(),V("div",ze,[o(b)==="index"?(v(),F(t,{key:0,"onUpdate:lookItem":f})):U("",!0),o(b)==="item"?(v(),F(q,{key:1,"onUpdate:lookIndex":w[0]||(w[0]=B=>b.value="index"),item:o(c)},null,8,["item"])):U("",!0)])}}});export{Ke as default};
