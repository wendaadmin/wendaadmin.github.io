import{d as N,r as E,e as O,f as j,o as b,c as V,b as h,g as n,w as a,h as v,u as o,s as X,t as Y,y as Z,i as ee,j as F,B as te,A as L,k as R,E as u,l as H,m as J,n as Q,v as oe,F as G,C as K,D as ne,G as se,H as le,I as ae,J as ie,K as re,p as ce,a as ue,_ as pe,L as de,M as S,N as z,z as me}from"./entry.da776960.js";import"./request.d230cc6d.js";import{t as fe,b as _e,c as ge,d as ye,e as ve,f as be,g as xe}from"./el-loading.d40747c9.js";/* empty css                  *//* empty css                */import{d as he}from"./dataExcelExport.a617cdae.js";import{_ as we}from"./client-only.ee2f8052.js";/* empty css                        */const ke={class:"w-full flex flex-col space-y-3"},Ce=N({__name:"Index",emits:["update:lookItem"],setup(w,{emit:x}){const c=E(!1),d=E(!1),y=O({content:[],totalElements:0}),k=i=>{R.prompt("请输入密码","删除",{confirmButtonText:"确定",cancelButtonText:"删除"}).then(async({value:g})=>{const p=await fe(i,g);p.code==200?(u({type:"success",message:p.msg}),t()):u({type:"error",message:p.msg})}).catch(()=>{u({type:"info",message:"Input canceled"})})},t=async()=>{try{d.value=!0;const i=await _e();i.code===200?y.content=i.data:u.error(i.msg)}catch{}finally{d.value=!1}},q=async()=>{const i=document.createElement("input");i.type="file",i.accept=".csv",i.onchange=async g=>{const p=g.target.files;if(p&&p.length>0){const r=p[0],l=new FormData;l.append("file",r);try{c.value=!0;const e=await ge(l);e.code===200?(u.success(e.msg),t()):u.error(e.msg)}catch(e){u.error("导入失败: "+(e.message||"未知错误"))}finally{c.value=!1}}},i.click()},B=async()=>{try{await he("题库下载模板",[["topicid","topic","questionid","questiontype","question","options","rates","status"]],[])}catch{}finally{}};return j(()=>{t()}),(i,g)=>{const p=H,r=J,l=Q,e=oe;return b(),V("div",ke,[h("div",null,[n(p,{type:"info",onClick:B,icon:o(X)},{default:a(()=>[v("下载模板")]),_:1},8,["icon"]),n(p,{type:"success",onClick:q,loading:o(c),icon:o(Y)},{default:a(()=>[v("导入")]),_:1},8,["loading","icon"]),n(p,{type:"primary",onClick:g[0]||(g[0]=s=>t()),loading:o(d),icon:o(Z)},{default:a(()=>[v("查询")]),_:1},8,["loading","icon"])]),ee((b(),F(l,{data:o(y).content,style:{width:"100%"},border:"",height:"700px"},{default:a(()=>[n(r,{prop:"topicid",label:"题库号",fixed:"",align:"center",width:"100px"}),n(r,{prop:"topic",label:"问卷名称",fixed:"",align:"center"}),n(r,{align:"center",label:"操作"},{default:a(s=>[n(p,{link:"",size:"small",type:"primary",onClick:I=>x("update:lookItem",s.row),icon:o(te)},{default:a(()=>[v(" 查看 ")]),_:2},1032,["onClick","icon"]),n(p,{size:"small",link:"",type:"danger",onClick:I=>k(s.row.topicid),icon:o(L)},{default:a(()=>[v(" 删除 ")]),_:2},1032,["onClick","icon"])]),_:1})]),_:1},8,["data"])),[[e,o(d)]])])}}});const P=w=>(ce("data-v-8453c6a5"),w=w(),ue(),w),Ee={class:"flex items-center"},$e={class:"ml-7"},Ve={class:"w-[105px] flex items-center mb-2"},qe=P(()=>h("span",{class:"text-[14px] text-[#626066]"},"问卷选项： ",-1)),Ie={class:"grid grid-cols-2 gap-3 pl-8"},Be=["onClick"],De=P(()=>h("span",null,"—",-1)),Te=[De],Oe={class:"flex items-center justify-center mt-5"},Fe=N({__name:"TopicAddOrEdit",props:{dialogVisible:{type:Boolean,default:!1},item:{default:null},topicid:{default:null}},emits:["update:closeDialog","update:success"],setup(w,{emit:x}){const c=w,d=E(!1),y=E(),k=O({question:[{required:!0,message:"请输入",trigger:"blur"}],options:[{required:!0,message:"请输入",trigger:"blur"}]}),t=O({question:"",questiontype:1,rates:[],status:1,options:[""]}),q=e=>{e&&e.resetFields()},B=async e=>{e&&(d.value||await e.validate(async(s,I)=>{var $;if(s)try{if(d.value=!0,!i())return;if(t.rates.reduce((A,U)=>A+Number(U),0)>=1){u.warning("概率总和已达1，无法添加新选项");return}const f={...t,options:t.options.join("|"),rates:t.rates.join("|")};let _;($=c.item)!=null&&$.id?_=await ye(c.topicid,c.item.id,f):_=await ve(c.topicid,f),_.code==200?(u.success({message:_.msg||"success",grouping:!0,type:"success"}),x("update:success"),g()):u.error({message:_.msg,grouping:!0,type:"error"})}catch{}finally{d.value=!1}}))},i=()=>{if(t.options.length!==t.rates.length)return u.warning("选项和概率数量不匹配"),!1;for(let e=0;e<t.options.length;e++)if(!t.options[e]||t.options[e].trim()==="")return u.warning(`第${e+1}个选项内容不能为空`),!1;for(let e=0;e<t.rates.length;e++)if(t.rates[e]===null||t.rates[e]===void 0||isNaN(t.rates[e]))return u.warning(`第${e+1}个选项概率不能为空`),!1;return!0},g=()=>{x("update:closeDialog"),q(y.value)},p=()=>{t.options.push(""),t.rates.push(.3)},r=e=>{t.options.length>1?t.options.splice(e,1):u.warning("至少保留一个选项")},l=async()=>{var s;t.question="",t.options=[""],t.rates=[.3];const e=JSON.parse(JSON.stringify(c.item));(s=c.item)!=null&&s.id&&(t.question=e.question,t.questiontype=e.type,t.options=e.options,t.rates=JSON.parse(e.rates))};return(e,s)=>{const I=ne,$=se,m=le,f=ae,_=H,A=ie,U=re,W=we;return b(),V("div",null,[n(W,null,{default:a(()=>{var M;return[n(U,{title:(M=c.item)!=null&&M.id?"编辑":"新增",draggable:"","model-value":e.$props.dialogVisible,top:"20px",style:{"border-radius":"10px","padding-bottom":"20px"},width:"700px",class:"px-5","align-center":"",onClose:g,onOpen:s[5]||(s[5]=C=>l())},{default:a(()=>[n(A,{ref_key:"ruleFormRef",ref:y,class:"w-full",inline:!0,"label-position":"right",model:o(t),"label-width":"100px",rules:o(k)},{default:a(()=>[n($,{label:"问卷内容:",prop:"question",class:"w-full"},{default:a(()=>[n(I,{style:{width:"100%"},"controls-position":"right",modelValue:o(t).question,"onUpdate:modelValue":s[0]||(s[0]=C=>o(t).question=C),placeholder:"请输入",clearable:""},null,8,["modelValue"])]),_:1}),h("div",Ee,[n($,{label:"选项类型:",prop:"questiontype"},{default:a(()=>[n(m,{size:"large",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},modelValue:o(t).questiontype,"onUpdate:modelValue":s[1]||(s[1]=C=>o(t).questiontype=C),"inline-prompt":"","active-text":"单选","inactive-text":"多选","active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),n($,{label:"状态:",prop:"status"},{default:a(()=>[n(m,{size:"large",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},modelValue:o(t).status,"onUpdate:modelValue":s[2]||(s[2]=C=>o(t).status=C),"inline-prompt":"","active-text":"可用","inactive-text":"不可用","active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),h("div",$e,[h("div",Ve,[qe,h("span",{class:"w-4 h-4 rounded-full bg-[#2b2b2bae] flex items-center justify-center text-[#EBEBEB] font-bold cursor-pointer hover:scale-110 duration-500",onClick:s[3]||(s[3]=C=>p())},"+")]),h("div",Ie,[(b(!0),V(G,null,K(o(t).options,(C,D)=>(b(),V("div",{key:D,class:"flex items-center space-x-1 relative"},[n(I,{class:"flex-1",modelValue:o(t).options[D],"onUpdate:modelValue":T=>o(t).options[D]=T,placeholder:"选项"},null,8,["modelValue","onUpdate:modelValue"]),n(f,{style:{width:"85px"},min:0,max:1,"controls-position":"right",modelValue:o(t).rates[D],"onUpdate:modelValue":T=>o(t).rates[D]=T,placeholder:"概率",clearable:""},null,8,["modelValue","onUpdate:modelValue"]),h("div",{class:"w-3 h-3 rounded-full absolute right-2 bg-[#f56c6c] flex items-center text-[6px] font-bold justify-center text-[#EBEBEB] cursor-pointer hover:scale-110 duration-500",onClick:T=>r(D)},Te,8,Be)]))),128))])]),h("div",Oe,[n(_,{type:"info",onClick:g},{default:a(()=>[v(" 取消 ")]),_:1}),n(_,{loading:o(d),type:"primary",onClick:s[4]||(s[4]=C=>B(o(y)))},{default:a(()=>[v(" 保存 ")]),_:1},8,["loading"])])]),_:1},8,["model","rules"])]),_:1},8,["title","model-value"])]}),_:1})])}}});const Ne=pe(Fe,[["__scopeId","data-v-8453c6a5"]]),Ae={class:"flex flex-col space-y-3"},Ue={key:0},Se=N({__name:"Item",props:{item:{default:null}},emits:["update:lookIndex"],setup(w,{emit:x}){const c=w,d=E(!1),y=E(null),k=E(!1),t=O({content:[],totalElements:0}),q=de(()=>{const r=Math.max(...t.content.map(l=>{var e;return((e=l.options)==null?void 0:e.length)||0}),0);return Array.from({length:r},(l,e)=>e)}),B=r=>String.fromCharCode(65+r),i=async()=>{var r;try{k.value=!0;const l=await be((r=c.item)==null?void 0:r.topicid);l.code===200?t.content=l.data:u.error(l.msg)}catch{}finally{k.value=!1}},g=r=>{d.value=!0,y.value=r},p=(r,l)=>{R.confirm("确定删除该条数据?","Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then(async()=>{const e=await xe(r,l);e.code==200?(u({type:"success",message:e.msg}),i()):u({type:"error",message:e.msg})}).catch(()=>{u({type:"info",message:"Delete canceled"})})};return j(async()=>{i()}),(r,l)=>{const e=H,s=J,I=Q,$=Ne;return b(),V("div",Ae,[h("div",null,[n(e,{type:"success",onClick:l[0]||(l[0]=m=>x("update:lookIndex"))},{default:a(()=>[v("返回")]),_:1}),n(e,{type:"success",onClick:l[1]||(l[1]=m=>g({}))},{default:a(()=>[v("新增")]),_:1})]),n(I,{data:o(t).content,style:{width:"100%"},border:"",height:"700px"},{default:a(()=>[n(s,{prop:"question",label:"问卷调查的内容",fixed:""}),n(s,{prop:"type",label:"类型",fixed:"",align:"center"},{default:a(m=>[v(S(m.row.type===1?"单选":"多选"),1)]),_:1}),n(s,{label:"问卷内容选项",align:"center"},{default:a(()=>[(b(!0),V(G,null,K(o(q),(m,f)=>(b(),F(s,{key:f,prop:"option"+f,label:`选项${f+1}`,"column-key":"option"+f},{default:a(_=>[_.row.options[f]?(b(),V("div",Ue,S(B(f))+". "+S(_.row.options[f]),1)):z("",!0)]),_:2},1032,["prop","label","column-key"]))),128))]),_:1}),n(s,{align:"center",label:"操作"},{default:a(m=>[n(e,{size:"small",link:"",type:"success",onClick:f=>g(m.row),icon:o(me)},{default:a(()=>[v(" 编辑 ")]),_:2},1032,["onClick","icon"]),n(e,{size:"small",link:"",type:"danger",onClick:f=>{var _;return p((_=c.item)==null?void 0:_.topicid,m.row.id)},icon:o(L)},{default:a(()=>[v(" 删除 ")]),_:2},1032,["onClick","icon"])]),_:1})]),_:1},8,["data"]),n($,{"dialog-visible":o(d),"onUpdate:closeDialog":l[2]||(l[2]=m=>d.value=!1),"onUpdate:success":l[3]||(l[3]=m=>i()),topicid:c.item.topicid,item:o(y)},null,8,["dialog-visible","topicid","item"])])}}}),ze={class:"w-full h-full flex flex-col space-y-3 overflow-auto"},Ke=N({__name:"questionnaireLibrary",setup(w){const x=E("index"),c=E(),d=y=>{c.value=y,x.value="item"};return(y,k)=>{const t=Ce,q=Se;return b(),V("div",ze,[o(x)==="index"?(b(),F(t,{key:0,"onUpdate:lookItem":d})):z("",!0),o(x)==="item"?(b(),F(q,{key:1,"onUpdate:lookIndex":k[0]||(k[0]=B=>x.value="index"),item:o(c)},null,8,["item"])):z("",!0)])}}});export{Ke as default};
