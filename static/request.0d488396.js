import{r as D,ay as O,az as A,aA as b,aB as R,a5 as B,u as g,aC as $,aD as M,aE as U,M as z,e as F,ae as H,E as P,ah as T}from"./entry.bd449256.js";const j=()=>null;function L(...s){const o=typeof s[s.length-1]=="string"?s.pop():void 0;typeof s[0]!="string"&&s.unshift(o);let[t,n,r={}]=s;if(typeof t!="string")throw new TypeError("[nuxt] [asyncData] key must be a string.");if(typeof n!="function")throw new TypeError("[nuxt] [asyncData] handler must be a function.");r.server=r.server??!0,r.default=r.default??j,r.lazy=r.lazy??!1,r.immediate=r.immediate??!0;const e=B(),l=()=>e.isHydrating?e.payload.data[t]:e.static.data[t],i=()=>l()!==void 0;e._asyncData[t]||(e._asyncData[t]={data:D(l()??r.default()),pending:D(!i()),error:O(e.payload._errors,t),status:D("idle")});const a={...e._asyncData[t]};a.refresh=a.execute=(u={})=>{if(e._asyncDataPromises[t]){if(u.dedupe===!1)return e._asyncDataPromises[t];e._asyncDataPromises[t].cancelled=!0}if((u._initial||e.isHydrating&&u._initial!==!1)&&i())return l();a.pending.value=!0,a.status.value="pending";const h=new Promise((c,d)=>{try{c(n(e))}catch(v){d(v)}}).then(c=>{if(h.cancelled)return e._asyncDataPromises[t];let d=c;r.transform&&(d=r.transform(c)),r.pick&&(d=S(d,r.pick)),a.data.value=d,a.error.value=null,a.status.value="success"}).catch(c=>{if(h.cancelled)return e._asyncDataPromises[t];a.error.value=c,a.data.value=g(r.default()),a.status.value="error"}).finally(()=>{h.cancelled||(a.pending.value=!1,e.payload.data[t]=a.data.value,a.error.value&&(e.payload._errors[t]=$(a.error.value)),delete e._asyncDataPromises[t])});return e._asyncDataPromises[t]=h,e._asyncDataPromises[t]};const f=()=>a.refresh({_initial:!0}),_=r.server!==!1&&e.payload.serverRendered;{const u=M();if(u&&!u._nuxtOnBeforeMountCbs){u._nuxtOnBeforeMountCbs=[];const c=u._nuxtOnBeforeMountCbs;u&&(A(()=>{c.forEach(d=>{d()}),c.splice(0,c.length)}),b(()=>c.splice(0,c.length)))}_&&e.isHydrating&&i()?(a.pending.value=!1,a.status.value=a.error.value?"error":"success"):u&&(e.payload.serverRendered&&e.isHydrating||r.lazy)&&r.immediate?u._nuxtOnBeforeMountCbs.push(f):r.immediate&&f(),r.watch&&R(r.watch,()=>a.refresh());const h=e.hook("app:data:refresh",c=>{if(!c||c.includes(t))return a.refresh()});u&&b(h)}const m=Promise.resolve(e._asyncDataPromises[t]).then(()=>a);return Object.assign(m,a),m}function S(s,o){const t={};for(const n of o)t[n]=s[n];return t}function G(s,o,t){const[n={},r]=typeof o=="string"?[{},o]:[o,t],e=n.key||U([r,g(n.baseURL),typeof s=="string"?s:"",g(n.params||n.query)]);if(!e||typeof e!="string")throw new TypeError("[nuxt] [useFetch] key must be a string: "+e);if(!s)throw new Error("[nuxt] [useFetch] request is missing.");const l=e===r?"$f"+e:e,i=z(()=>{let p=s;return typeof p=="function"&&(p=p()),g(p)});if(!n.baseURL&&typeof i.value=="string"&&i.value.startsWith("//"))throw new Error('[nuxt] [useFetch] the request URL must not start with "//".');const{server:a,lazy:f,default:_,transform:m,pick:u,watch:h,immediate:c,...d}=n,v=F({...d,cache:typeof n.cache=="boolean"?void 0:n.cache}),C={server:a,lazy:f,default:_,transform:m,pick:u,immediate:c,watch:h===!1?[]:[v,i,...h||[]]};let y;return L(l,()=>{var w;return(w=y==null?void 0:y.abort)==null||w.call(y),y=typeof AbortController<"u"?new AbortController:{},typeof i.value=="string"&&i.value.startsWith("/"),(n.$fetch||globalThis.$fetch)(i.value,{signal:y.signal,...v})},C)}const q="https://apialpha.cdcdx.com";let E=!1,I=0;const K=2e4,W=s=>({"Content-Type":"application/json",Authorization:`Bearer ${s}`}),k=s=>{var r,e,l,i,a,f;const o=Date.now(),t=((r=s.data)==null?void 0:r.message)||((e=s.data)==null?void 0:e.msg)||((a=(i=(l=s.data)==null?void 0:l.detail)==null?void 0:i[0])==null?void 0:a.msg)||s.detail||((f=s.data)==null?void 0:f.detail)||"network error",n=s.statusCode;if(!((t==="network error"||n===502)&&o-I<K)&&n!==502){if(n===403){T("/login");return}if(n!==503){P.error(t);return}}},x=async(s,o,t)=>{const n=H();let r={};(o==null?void 0:o.body)instanceof FormData?r={Authorization:`Bearer ${n.getToken}`}:r=W(n.getToken);const l=`${n.getApiAddress?n.getApiAddress:q}${s}`;try{const{data:i,error:a}=await G(l,{...o,headers:r,responseType:t},"$mr5k66ooDp");if(i.value)return i.value;const{statusCode:f}=a.value;if(a.value)return f===401||f===403&&!E?(P.error(a.value.data.detail),E=!0,T("/login"),!1):k(a.value)}catch(i){return k(i)}},Q=(s,o,t="json")=>x(s,{method:"GET",params:o},t),V=(s,o,t="json")=>x(s,{method:"POST",body:o},t);export{Q as G,V as P};
