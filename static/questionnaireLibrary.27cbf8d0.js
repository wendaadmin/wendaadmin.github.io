import{d as F,r as V,e as O,f as L,o as x,c as q,b as v,g as n,w as l,u as o,t as X,h as b,x as Y,z as Z,i as ee,j as A,C as te,B as M,k as R,E as c,l as z,m as oe,n as J,q as Q,v as ne,F as G,D as K,G as se,H as le,I as ae,J as ie,K as re,L as ce,p as ue,a as pe,_ as de,M as me,N as S,O as j,A as fe}from"./entry.f8e2d54a.js";import"./request.52452cd7.js";/* empty css                  */import{t as _e,b as ge,c as ve,d as ye,e as be,f as xe,g as he}from"./el-loading.03f9fcac.js";/* empty css                */import{d as we}from"./dataExcelExport.a617cdae.js";import{_ as ke}from"./client-only.6c4ec1d7.js";/* empty css                        */const Ce=""+globalThis.__publicAssetsURL("images/questionnaire.png"),Ee={class:"w-full flex flex-col space-y-3"},$e=v("div",{class:"w-full h-[120px]"},[v("img",{src:Ce,alt:"",class:"w-full h-full object-contain"})],-1),Ve=F({__name:"Index",emits:["update:lookItem"],setup(k,{emit:h}){const r=V(!1),d=V(!1),y=O({content:[],totalElements:0}),C=i=>{R.prompt("请输入密码","删除",{confirmButtonText:"确定",cancelButtonText:"删除"}).then(async({value:g})=>{const u=await _e(i,g);u.code==200?(c({type:"success",message:u.msg}),t()):c({type:"error",message:u.msg})}).catch(()=>{c({type:"info",message:"Input canceled"})})},t=async()=>{try{d.value=!0;const i=await ge();i.code===200?y.content=i.data:c.error(i.msg)}catch{}finally{d.value=!1}},I=async()=>{const i=document.createElement("input");i.type="file",i.accept=".csv",i.onchange=async g=>{const u=g.target.files;if(u&&u.length>0){const p=u[0],s=new FormData;s.append("file",p);try{r.value=!0;const e=await ve(s);e.code===200?(c.success(e.msg),t()):c.error(e.msg)}catch(e){c.error("导入失败: "+(e.message||"未知错误"))}finally{r.value=!1}}},i.click()},B=async()=>{try{await we("题库下载模板",[["topicid","topic","questionid","questiontype","question","options","rates","status"]],[])}catch{}finally{}};return L(()=>{t()}),(i,g)=>{const u=z,p=oe,s=J,e=Q,a=ne;return x(),q("div",Ee,[v("div",null,[n(p,{placement:"top",effect:"dark"},{content:l(()=>[$e]),default:l(()=>[n(u,{type:"info",onClick:B,icon:o(X)},{default:l(()=>[b("下载模板")]),_:1},8,["icon"])]),_:1}),n(u,{type:"success",onClick:I,loading:o(r),icon:o(Y)},{default:l(()=>[b("导入")]),_:1},8,["loading","icon"]),n(u,{type:"primary",onClick:g[0]||(g[0]=E=>t()),loading:o(d),icon:o(Z)},{default:l(()=>[b("查询")]),_:1},8,["loading","icon"])]),ee((x(),A(e,{data:o(y).content,style:{width:"100%"},border:"",height:"700px"},{default:l(()=>[n(s,{prop:"topicid",label:"问卷号",fixed:"",align:"center",width:"100px"}),n(s,{prop:"topic",label:"问卷名称",fixed:"",align:"center"}),n(s,{align:"center",label:"操作"},{default:l(E=>[n(u,{link:"",size:"small",type:"primary",onClick:w=>h("update:lookItem",E.row),icon:o(te)},{default:l(()=>[b(" 查看 ")]),_:2},1032,["onClick","icon"]),n(u,{size:"small",link:"",type:"danger",onClick:w=>C(E.row.topicid),icon:o(M)},{default:l(()=>[b(" 删除 ")]),_:2},1032,["onClick","icon"])]),_:1})]),_:1},8,["data"])),[[a,o(d)]])])}}});const P=k=>(ue("data-v-8453c6a5"),k=k(),pe(),k),qe={class:"flex items-center"},Ie={class:"ml-7"},Be={class:"w-[105px] flex items-center mb-2"},Te=P(()=>v("span",{class:"text-[14px] text-[#626066]"},"问卷选项： ",-1)),De={class:"grid grid-cols-2 gap-3 pl-8"},Oe=["onClick"],Ae=P(()=>v("span",null,"—",-1)),Fe=[Ae],Ne={class:"flex items-center justify-center mt-5"},Ue=F({__name:"TopicAddOrEdit",props:{dialogVisible:{type:Boolean,default:!1},item:{default:null},topicid:{default:null}},emits:["update:closeDialog","update:success"],setup(k,{emit:h}){const r=k,d=V(!1),y=V(),C=O({question:[{required:!0,message:"请输入",trigger:"blur"}],options:[{required:!0,message:"请输入",trigger:"blur"}]}),t=O({question:"",questiontype:1,rates:[],status:1,options:[""]}),I=e=>{e&&e.resetFields()},B=async e=>{e&&(d.value||await e.validate(async(a,E)=>{var w;if(a)try{if(d.value=!0,!i())return;if(t.rates.reduce((N,U)=>N+Number(U),0)>=1){c.warning("概率总和已达1，无法添加新选项");return}const f={...t,options:t.options.join("|"),rates:t.rates.join("|")};let _;(w=r.item)!=null&&w.id?_=await ye(r.topicid,r.item.id,f):_=await be(r.topicid,f),_.code==200?(c.success({message:_.msg||"success",grouping:!0,type:"success"}),h("update:success"),g()):c.error({message:_.msg,grouping:!0,type:"error"})}catch{}finally{d.value=!1}}))},i=()=>{if(t.options.length!==t.rates.length)return c.warning("选项和概率数量不匹配"),!1;for(let e=0;e<t.options.length;e++)if(!t.options[e]||t.options[e].trim()==="")return c.warning(`第${e+1}个选项内容不能为空`),!1;for(let e=0;e<t.rates.length;e++)if(t.rates[e]===null||t.rates[e]===void 0||isNaN(t.rates[e]))return c.warning(`第${e+1}个选项概率不能为空`),!1;return!0},g=()=>{h("update:closeDialog"),I(y.value)},u=()=>{t.options.push(""),t.rates.push(.3)},p=e=>{t.options.length>1?t.options.splice(e,1):c.warning("至少保留一个选项")},s=async()=>{var a;t.question="",t.options=[""],t.rates=[.3];const e=JSON.parse(JSON.stringify(r.item));(a=r.item)!=null&&a.id&&(t.question=e.question,t.questiontype=e.type,t.options=e.options,t.rates=JSON.parse(e.rates))};return(e,a)=>{const E=se,w=le,m=ae,f=ie,_=z,N=re,U=ce,W=ke;return x(),q("div",null,[n(W,null,{default:l(()=>{var H;return[n(U,{title:(H=r.item)!=null&&H.id?"编辑":"新增",draggable:"","model-value":e.$props.dialogVisible,top:"20px",style:{"border-radius":"10px","padding-bottom":"20px"},width:"700px",class:"px-5","align-center":"",onClose:g,onOpen:a[5]||(a[5]=$=>s())},{default:l(()=>[n(N,{ref_key:"ruleFormRef",ref:y,class:"w-full",inline:!0,"label-position":"right",model:o(t),"label-width":"100px",rules:o(C)},{default:l(()=>[n(w,{label:"问卷内容:",prop:"question",class:"w-full"},{default:l(()=>[n(E,{style:{width:"100%"},"controls-position":"right",modelValue:o(t).question,"onUpdate:modelValue":a[0]||(a[0]=$=>o(t).question=$),placeholder:"请输入",clearable:""},null,8,["modelValue"])]),_:1}),v("div",qe,[n(w,{label:"选项类型:",prop:"questiontype"},{default:l(()=>[n(m,{size:"large",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},modelValue:o(t).questiontype,"onUpdate:modelValue":a[1]||(a[1]=$=>o(t).questiontype=$),"inline-prompt":"","active-text":"单选","inactive-text":"多选","active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1}),n(w,{label:"状态:",prop:"status"},{default:l(()=>[n(m,{size:"large",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},modelValue:o(t).status,"onUpdate:modelValue":a[2]||(a[2]=$=>o(t).status=$),"inline-prompt":"","active-text":"可用","inactive-text":"不可用","active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1})]),v("div",Ie,[v("div",Be,[Te,v("span",{class:"w-4 h-4 rounded-full bg-[#2b2b2bae] flex items-center justify-center text-[#EBEBEB] font-bold cursor-pointer hover:scale-110 duration-500",onClick:a[3]||(a[3]=$=>u())},"+")]),v("div",De,[(x(!0),q(G,null,K(o(t).options,($,T)=>(x(),q("div",{key:T,class:"flex items-center space-x-1 relative"},[n(E,{class:"flex-1",modelValue:o(t).options[T],"onUpdate:modelValue":D=>o(t).options[T]=D,placeholder:"选项"},null,8,["modelValue","onUpdate:modelValue"]),n(f,{style:{width:"85px"},min:0,max:1,"controls-position":"right",modelValue:o(t).rates[T],"onUpdate:modelValue":D=>o(t).rates[T]=D,placeholder:"概率",clearable:""},null,8,["modelValue","onUpdate:modelValue"]),v("div",{class:"w-3 h-3 rounded-full absolute right-2 bg-[#f56c6c] flex items-center text-[6px] font-bold justify-center text-[#EBEBEB] cursor-pointer hover:scale-110 duration-500",onClick:D=>p(T)},Fe,8,Oe)]))),128))])]),v("div",Ne,[n(_,{type:"info",onClick:g},{default:l(()=>[b(" 取消 ")]),_:1}),n(_,{loading:o(d),type:"primary",onClick:a[4]||(a[4]=$=>B(o(y)))},{default:l(()=>[b(" 保存 ")]),_:1},8,["loading"])])]),_:1},8,["model","rules"])]),_:1},8,["title","model-value"])]}),_:1})])}}});const Se=de(Ue,[["__scopeId","data-v-8453c6a5"]]),je={class:"flex flex-col space-y-3"},ze={key:0},He=F({__name:"Item",props:{item:{default:null}},emits:["update:lookIndex"],setup(k,{emit:h}){const r=k,d=V(!1),y=V(null),C=V(!1),t=O({content:[],totalElements:0}),I=me(()=>{const p=Math.max(...t.content.map(s=>{var e;return((e=s.options)==null?void 0:e.length)||0}),0);return Array.from({length:p},(s,e)=>e)}),B=p=>String.fromCharCode(65+p),i=async()=>{var p;try{C.value=!0;const s=await xe((p=r.item)==null?void 0:p.topicid);s.code===200?t.content=s.data:c.error(s.msg)}catch{}finally{C.value=!1}},g=p=>{d.value=!0,y.value=p},u=(p,s)=>{R.confirm("确定删除该条数据?","Warning",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then(async()=>{const e=await he(p,s);e.code==200?(c({type:"success",message:e.msg}),i()):c({type:"error",message:e.msg})}).catch(()=>{c({type:"info",message:"Delete canceled"})})};return L(async()=>{i()}),(p,s)=>{const e=z,a=J,E=Q,w=Se;return x(),q("div",je,[v("div",null,[n(e,{type:"success",onClick:s[0]||(s[0]=m=>h("update:lookIndex"))},{default:l(()=>[b("返回")]),_:1}),n(e,{type:"success",onClick:s[1]||(s[1]=m=>g({}))},{default:l(()=>[b("新增")]),_:1})]),n(E,{data:o(t).content,style:{width:"100%"},border:"",height:"700px"},{default:l(()=>[n(a,{prop:"question",label:"问卷调查的内容",fixed:""}),n(a,{prop:"type",label:"类型",fixed:"",align:"center"},{default:l(m=>[b(S(m.row.type===1?"单选":"多选"),1)]),_:1}),n(a,{label:"问卷内容选项",align:"center"},{default:l(()=>[(x(!0),q(G,null,K(o(I),(m,f)=>(x(),A(a,{key:f,prop:"option"+f,label:`选项${f+1}`,"column-key":"option"+f},{default:l(_=>[_.row.options[f]?(x(),q("div",ze,S(B(f))+". "+S(_.row.options[f]),1)):j("",!0)]),_:2},1032,["prop","label","column-key"]))),128))]),_:1}),n(a,{align:"center",label:"操作"},{default:l(m=>[n(e,{size:"small",link:"",type:"success",onClick:f=>g(m.row),icon:o(fe)},{default:l(()=>[b(" 编辑 ")]),_:2},1032,["onClick","icon"]),n(e,{size:"small",link:"",type:"danger",onClick:f=>{var _;return u((_=r.item)==null?void 0:_.topicid,m.row.id)},icon:o(M)},{default:l(()=>[b(" 删除 ")]),_:2},1032,["onClick","icon"])]),_:1})]),_:1},8,["data"]),n(w,{"dialog-visible":o(d),"onUpdate:closeDialog":s[2]||(s[2]=m=>d.value=!1),"onUpdate:success":s[3]||(s[3]=m=>i()),topicid:r.item.topicid,item:o(y)},null,8,["dialog-visible","topicid","item"])])}}}),Le={class:"w-full h-full flex flex-col space-y-3 overflow-auto"},Xe=F({__name:"questionnaireLibrary",setup(k){const h=V("index"),r=V(),d=y=>{r.value=y,h.value="item"};return(y,C)=>{const t=Ve,I=He;return x(),q("div",Le,[o(h)==="index"?(x(),A(t,{key:0,"onUpdate:lookItem":d})):j("",!0),o(h)==="item"?(x(),A(I,{key:1,"onUpdate:lookIndex":C[0]||(C[0]=B=>h.value="index"),item:o(r)},null,8,["item"])):j("",!0)])}}});export{Xe as default};
